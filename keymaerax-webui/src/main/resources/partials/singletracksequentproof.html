<!-- Open Goal -->
<div class="row k4-proofrow-first">
    <div class="col-md-12">
        <!-- need duplication because 'step.subgoals.length > 0' is non-assignable -->
        <k4-sequent user-id="userId" proof-id="proofId" node-id="nodeId" goal-id="deductionPath[0].id"
                    sequent="proofTree.nodesMap[deductionPath[0].id].sequent"
                    read-only="readOnly" collapsed="false" on-use-at="onUseAt(formulaId, axiomId)"></k4-sequent>
    </div>
</div>
<!-- Conclusion -->
<div uib-collapse="isConclusionCollapsed($index)" class="row k4-proofrow" ng-repeat="step in deductionPath.slice(1)">
    <div class="col-md-12 k4-goalwithsiblings">
        <k4-sequent user-id="userId" proof-id="proofId" node-id="nodeId" goal-id="deductionPath[0].id"
                    sequent="proofTree.nodesMap[step.id].sequent"
                    read-only="true" collapsed="true" on-use-at="onUseAt(formulaId, axiomId)"></k4-sequent>
        <ul>
            <li ng-repeat="sibling in siblingCandidates(proofTree.nodesMap[step.id].children)">
                <!-- assumes that only one agenda item mentions a specific node in the proof tree -->
                <!-- todo HTML tooltip would be nice, but couldn't get to work so far -->
                <a ng-click="agenda.select(agenda.itemsByProofStep(sibling)[0])"
                   uib-tooltip="{{tooltip(proofTree.nodesMap[sibling].sequent)}}"
                   tooltip-placement="top">{{agenda.itemsByProofStep(sibling)[0].id}}</a>
            </li>
        </ul>
    </div>
    <ul>
        <li >
            <span>
                <!-- Show collapse button on first element -->
                <span uib-tooltip="{{proofTree.nodesMap[step.id].rule.name}}" tooltip-placement="right">{{proofTree.nodesMap[step.id].rule.name}}</span>
                <a ng-if="!conclusionIsCollapsed($index)" ng-click="setConclusionCollapsed($index, true)"><span class="fa fa-minus-square-o"></span></a>
            </span>
        </li>
    </ul>
    <!-- add buttons: rewind to here, start alternative proof attempt etc. -->
</div>
<!-- button to collapse/uncollapse (fetch data, if necessary) -->
<div class="row k4-proofrow" ng-if="minCollapsedIndex() < deductionPath.length-1 || deductionPath[deductionPath.length-1].id !== proofTree.root">
    <ul>
        <li>
            <a ng-click="fetchParent(deductionPath[Math.min(deductionPath.length-1, minCollapsedIndex())].id)"
               ng-right-click="fetchParentRightClick($event)"
               uib-popover-template="'navigateTowardsRootPopoverHtml'" popover-title="Proof history"
               popover-placement="bottom" popover-trigger="contextmenu" tabindex="-1">
                <span class="fa fa-plus-square-o"></span>
            </a>
        </li>
    </ul>
</div>
<script type="text/ng-template" id="navigateTowardsRootPopoverHtml">
    <div>
        <a ng-click="fetchBranchRoot"><span class="fa fa-code-fork"> Show branch root</span></a>
        <a ng-click="fetchTreeRoot"><span class="fa fa-angle-down"> Show tree root</span></a>
        <a ng-click="fetchPathAll(deductionPath[deductionPath.length-1].id)">
            <span class="fa fa-angle-double-down"> Expand all</span>
        </a>
    </div>
</script>
